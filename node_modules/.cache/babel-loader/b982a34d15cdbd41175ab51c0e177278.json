{"ast":null,"code":"import _objectSpread from\"E:/projects/localtalk.mobi/mobilechat-adminpanel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"E:/projects/localtalk.mobi/mobilechat-adminpanel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"E:/projects/localtalk.mobi/mobilechat-adminpanel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"E:/projects/localtalk.mobi/mobilechat-adminpanel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectWithoutProperties from\"E:/projects/localtalk.mobi/mobilechat-adminpanel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";var _excluded=[\"disabled\",\"conversationId\",\"onSend\",\"conversationKey\"];import{v4 as uuidv4}from'uuid';import{Icon}from'@iconify/react';import{useRef,useState}from'react';import micFill from'@iconify/icons-eva/mic-fill';import roundSend from'@iconify/icons-ic/round-send';import attach2Fill from'@iconify/icons-eva/attach-2-fill';import roundAddPhotoAlternate from'@iconify/icons-ic/round-add-photo-alternate';// material\nimport{styled}from'@material-ui/core/styles';import{Input,Divider,IconButton,InputAdornment,Stack}from'@material-ui/core';// redux\nimport{useDispatch,useSelector}from'../../../redux/store';import{addRecipients,onSendMessage,getConversation,getParticipants,markConversationAsRead,resetActiveConversation}from'../../../redux/slices/chat';import axios from'../../../utils/axios';// hooks\nimport useAuth from'../../../hooks/useAuth';//\nimport EmojiPicker from'../../EmojiPicker';// ----------------------------------------------------------------------\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var RootStyle=styled('div')(function(_ref){var theme=_ref.theme;return{minHeight:56,display:'flex',position:'relative',alignItems:'center',paddingLeft:theme.spacing(2)};});// ----------------------------------------------------------------------\nexport default function ChatMessageInput(_ref2){var disabled=_ref2.disabled,conversationId=_ref2.conversationId,onSend=_ref2.onSend,conversationKey=_ref2.conversationKey,other=_objectWithoutProperties(_ref2,_excluded);var dispatch=useDispatch();var fileInputRef=useRef(null);var _useState=useState(''),_useState2=_slicedToArray(_useState,2),message=_useState2[0],setMessage=_useState2[1];var _useAuth=useAuth(),user=_useAuth.user;var handleAttach=function handleAttach(){fileInputRef.current.click();};var handleChangeMessage=function handleChangeMessage(event){setMessage(event.target.value);};var handleKeyUp=function handleKeyUp(event){if(event.key==='Enter'){handleSend();}};var handleSend=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var accessToken,authHeader,resp;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(message){_context.next=2;break;}return _context.abrupt(\"return\",'');case 2:if(!onSend){_context.next=10;break;}accessToken=window.localStorage.getItem('accessToken');authHeader={headers:{Authorization:\"Bearer \".concat(accessToken)}};onSend({conversationId:conversationId,messageId:uuidv4(),message:message,contentType:'text',attachments:[],createdAt:new Date(),senderId:user});_context.next=8;return axios.post('/chat/messages/new',{conversationId:conversationId,attachments:[],message:message,conversationKey:conversationKey},authHeader);case 8:resp=_context.sent;dispatch(getConversation(resp.data.conversationKey));case 10:return _context.abrupt(\"return\",setMessage(''));case 11:case\"end\":return _context.stop();}}},_callee);}));return function handleSend(){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(RootStyle,_objectSpread(_objectSpread({},other),{},{children:[/*#__PURE__*/_jsx(Input,{disabled:disabled,fullWidth:true,value:message,disableUnderline:true,onKeyUp:handleKeyUp,onChange:handleChangeMessage,placeholder:\"Type a message\",startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:/*#__PURE__*/_jsx(EmojiPicker,{disabled:disabled,value:message,setValue:setMessage})}),sx:{height:'100%'}}),/*#__PURE__*/_jsx(Divider,{orientation:\"vertical\",flexItem:true}),/*#__PURE__*/_jsx(IconButton,{color:\"primary\",disabled:!message,onClick:handleSend,sx:{mx:1},children:/*#__PURE__*/_jsx(Icon,{icon:roundSend,width:24,height:24})}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",ref:fileInputRef,style:{display:'none'}})]}));}","map":{"version":3,"sources":["E:/projects/localtalk.mobi/mobilechat-adminpanel/src/components/_dashboard/chat/ChatMessageInput.js"],"names":["v4","uuidv4","Icon","useRef","useState","micFill","roundSend","attach2Fill","roundAddPhotoAlternate","styled","Input","Divider","IconButton","InputAdornment","Stack","useDispatch","useSelector","addRecipients","onSendMessage","getConversation","getParticipants","markConversationAsRead","resetActiveConversation","axios","useAuth","EmojiPicker","RootStyle","theme","minHeight","display","position","alignItems","paddingLeft","spacing","ChatMessageInput","disabled","conversationId","onSend","conversationKey","other","dispatch","fileInputRef","message","setMessage","user","handleAttach","current","click","handleChangeMessage","event","target","value","handleKeyUp","key","handleSend","accessToken","window","localStorage","getItem","authHeader","headers","Authorization","messageId","contentType","attachments","createdAt","Date","senderId","post","resp","data","height","mx"],"mappings":"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","sourcesContent":["import { v4 as uuidv4 } from 'uuid';\r\nimport PropTypes from 'prop-types';\r\nimport { Icon } from '@iconify/react';\r\nimport { useRef, useState } from 'react';\r\nimport micFill from '@iconify/icons-eva/mic-fill';\r\nimport roundSend from '@iconify/icons-ic/round-send';\r\nimport attach2Fill from '@iconify/icons-eva/attach-2-fill';\r\nimport roundAddPhotoAlternate from '@iconify/icons-ic/round-add-photo-alternate';\r\n// material\r\nimport { styled } from '@material-ui/core/styles';\r\nimport { Input, Divider, IconButton, InputAdornment, Stack } from '@material-ui/core';\r\n// redux\r\nimport { useDispatch, useSelector } from '../../../redux/store';\r\nimport {\r\n  addRecipients,\r\n  onSendMessage,\r\n  getConversation,\r\n  getParticipants,\r\n  markConversationAsRead,\r\n  resetActiveConversation\r\n} from '../../../redux/slices/chat';\r\nimport axios from '../../../utils/axios';\r\n// hooks\r\nimport useAuth from '../../../hooks/useAuth';\r\n//\r\nimport EmojiPicker from '../../EmojiPicker';\r\n\r\n// ----------------------------------------------------------------------\r\n\r\nconst RootStyle = styled('div')(({ theme }) => ({\r\n  minHeight: 56,\r\n  display: 'flex',\r\n  position: 'relative',\r\n  alignItems: 'center',\r\n  paddingLeft: theme.spacing(2)\r\n}));\r\n\r\n// ----------------------------------------------------------------------\r\n\r\nChatMessageInput.propTypes = {\r\n  disabled: PropTypes.bool,\r\n  conversationId: PropTypes.string,\r\n  onSend: PropTypes.func\r\n};\r\n\r\nexport default function ChatMessageInput({ disabled, conversationId, onSend, conversationKey, ...other }) {\r\n  const dispatch = useDispatch();\r\n  const fileInputRef = useRef(null);\r\n  const [message, setMessage] = useState('');\r\n  const { user } = useAuth();\r\n\r\n  const handleAttach = () => {\r\n    fileInputRef.current.click();\r\n  };\r\n\r\n  const handleChangeMessage = (event) => {\r\n    setMessage(event.target.value);\r\n  };\r\n\r\n  const handleKeyUp = (event) => {\r\n    if (event.key === 'Enter') {\r\n      handleSend();\r\n    }\r\n  };\r\n\r\n  const handleSend = async () => {\r\n    if (!message) {\r\n      return '';\r\n    }\r\n    if (onSend) {\r\n      const accessToken = window.localStorage.getItem('accessToken');\r\n      const authHeader = {\r\n        headers: {\r\n          Authorization: `Bearer ${accessToken}`\r\n        }\r\n      };\r\n\r\n      onSend({\r\n        conversationId,\r\n        messageId: uuidv4(),\r\n        message,\r\n        contentType: 'text',\r\n        attachments: [],\r\n        createdAt: new Date(),\r\n        senderId: user\r\n      });\r\n\r\n      const resp = await axios.post(\r\n        '/chat/messages/new',\r\n        {\r\n          conversationId,\r\n          attachments: [],\r\n          message,\r\n          conversationKey\r\n        },\r\n        authHeader\r\n      );\r\n      dispatch(getConversation(resp.data.conversationKey));\r\n    }\r\n    return setMessage('');\r\n  };\r\n\r\n  return (\r\n    <RootStyle {...other}>\r\n      <Input\r\n        disabled={disabled}\r\n        fullWidth\r\n        value={message}\r\n        disableUnderline\r\n        onKeyUp={handleKeyUp}\r\n        onChange={handleChangeMessage}\r\n        placeholder=\"Type a message\"\r\n        startAdornment={\r\n          <InputAdornment position=\"start\">\r\n            <EmojiPicker disabled={disabled} value={message} setValue={setMessage} />\r\n          </InputAdornment>\r\n        }\r\n        sx={{ height: '100%' }}\r\n      />\r\n\r\n      <Divider orientation=\"vertical\" flexItem />\r\n\r\n      <IconButton color=\"primary\" disabled={!message} onClick={handleSend} sx={{ mx: 1 }}>\r\n        <Icon icon={roundSend} width={24} height={24} />\r\n      </IconButton>\r\n\r\n      <input type=\"file\" ref={fileInputRef} style={{ display: 'none' }} />\r\n    </RootStyle>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}