{"ast":null,"code":"import _regeneratorRuntime from\"E:/projects/localtalk.mobi/mobilechat-adminpanel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"E:/projects/localtalk.mobi/mobilechat-adminpanel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"E:/projects/localtalk.mobi/mobilechat-adminpanel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"E:/projects/localtalk.mobi/mobilechat-adminpanel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{createContext,useEffect,useReducer}from'react';// utils\nimport axios from'../utils/axios';import{isValidToken,setSession}from'../utils/jwt';// ----------------------------------------------------------------------\nimport{jsx as _jsx}from\"react/jsx-runtime\";var initialState={isAuthenticated:false,isInitialized:false,user:null};var handlers={INITIALIZE:function INITIALIZE(state,action){var _action$payload=action.payload,isAuthenticated=_action$payload.isAuthenticated,user=_action$payload.user;return _objectSpread(_objectSpread({},state),{},{isAuthenticated:isAuthenticated,isInitialized:true,user:user});},LOGIN:function LOGIN(state,action){var user=action.payload.user;return _objectSpread(_objectSpread({},state),{},{isAuthenticated:true,user:user});},LOGOUT:function LOGOUT(state){return _objectSpread(_objectSpread({},state),{},{isAuthenticated:false,user:null});},REGISTER:function REGISTER(state,action){var user=action.payload.user;return _objectSpread(_objectSpread({},state),{},{isAuthenticated:true,user:user});}};var reducer=function reducer(state,action){return handlers[action.type]?handlers[action.type](state,action):state;};var AuthContext=/*#__PURE__*/createContext(_objectSpread(_objectSpread({},initialState),{},{method:'jwt',login:function login(){return Promise.resolve();},logout:function logout(){return Promise.resolve();},register:function register(){return Promise.resolve();}}));function AuthProvider(_ref){var children=_ref.children;var _useReducer=useReducer(reducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];useEffect(function(){var initialize=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var accessToken,response,user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;accessToken=window.localStorage.getItem('accessToken');if(!(accessToken&&isValidToken(accessToken))){_context.next=11;break;}setSession(accessToken);_context.next=6;return axios.get('/auth/me',{headers:{Authorization:\"Bearer \".concat(accessToken)}});case 6:response=_context.sent;user=response.data.user;dispatch({type:'INITIALIZE',payload:{isAuthenticated:true,user:user}});_context.next=12;break;case 11:dispatch({type:'INITIALIZE',payload:{isAuthenticated:false,user:null}});case 12:_context.next=18;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);console.error(_context.t0);dispatch({type:'INITIALIZE',payload:{isAuthenticated:false,user:null}});case 18:case\"end\":return _context.stop();}}},_callee,null,[[0,14]]);}));return function initialize(){return _ref2.apply(this,arguments);};}();initialize();},[]);var login=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email,password){var response,_response$data,accessToken,user;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post('/auth/adminlogin',{email:email,password:password});case 2:response=_context2.sent;if(response.data.success){_response$data=response.data,accessToken=_response$data.accessToken,user=_response$data.user;setSession(accessToken);dispatch({type:'LOGIN',payload:{user:user}});}else{dispatch({type:'INITIALIZE',payload:{isAuthenticated:false,user:null}});}return _context2.abrupt(\"return\",response);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function login(_x,_x2){return _ref3.apply(this,arguments);};}();var register=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(email,password,firstName,lastName){var response,_response$data2,accessToken,user;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.post('/api/account/register',{email:email,password:password,firstName:firstName,lastName:lastName});case 2:response=_context3.sent;_response$data2=response.data,accessToken=_response$data2.accessToken,user=_response$data2.user;window.localStorage.setItem('accessToken',accessToken);dispatch({type:'REGISTER',payload:{user:user}});case 6:case\"end\":return _context3.stop();}}},_callee3);}));return function register(_x3,_x4,_x5,_x6){return _ref4.apply(this,arguments);};}();var logout=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return axios.post(\"/auth/logout\");case 2:setSession(null);dispatch({type:'LOGOUT'});case 4:case\"end\":return _context4.stop();}}},_callee4);}));return function logout(){return _ref5.apply(this,arguments);};}();var resetPassword=function resetPassword(){};var updateProfile=function updateProfile(){};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:_objectSpread(_objectSpread({},state),{},{method:'jwt',login:login,logout:logout,register:register,resetPassword:resetPassword,updateProfile:updateProfile}),children:children});}export{AuthContext,AuthProvider};","map":{"version":3,"sources":["E:/projects/localtalk.mobi/mobilechat-adminpanel/src/contexts/JWTContext.js"],"names":["createContext","useEffect","useReducer","axios","isValidToken","setSession","initialState","isAuthenticated","isInitialized","user","handlers","INITIALIZE","state","action","payload","LOGIN","LOGOUT","REGISTER","reducer","type","AuthContext","method","login","Promise","resolve","logout","register","AuthProvider","children","dispatch","initialize","accessToken","window","localStorage","getItem","get","headers","Authorization","response","data","console","error","email","password","post","success","firstName","lastName","setItem","resetPassword","updateProfile"],"mappings":"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","sourcesContent":["import { createContext, useEffect, useReducer } from 'react';\r\nimport PropTypes from 'prop-types';\r\n// utils\r\nimport axios from '../utils/axios';\r\nimport { isValidToken, setSession } from '../utils/jwt';\r\n\r\n// ----------------------------------------------------------------------\r\n\r\nconst initialState = {\r\n  isAuthenticated: false,\r\n  isInitialized: false,\r\n  user: null\r\n};\r\n\r\nconst handlers = {\r\n  INITIALIZE: (state, action) => {\r\n    const { isAuthenticated, user } = action.payload;\r\n    return {\r\n      ...state,\r\n      isAuthenticated,\r\n      isInitialized: true,\r\n      user\r\n    };\r\n  },\r\n  LOGIN: (state, action) => {\r\n    const { user } = action.payload;\r\n\r\n    return {\r\n      ...state,\r\n      isAuthenticated: true,\r\n      user\r\n    };\r\n  },\r\n  LOGOUT: (state) => ({\r\n    ...state,\r\n    isAuthenticated: false,\r\n    user: null\r\n  }),\r\n  REGISTER: (state, action) => {\r\n    const { user } = action.payload;\r\n\r\n    return {\r\n      ...state,\r\n      isAuthenticated: true,\r\n      user\r\n    };\r\n  }\r\n};\r\n\r\nconst reducer = (state, action) => (handlers[action.type] ? handlers[action.type](state, action) : state);\r\n\r\nconst AuthContext = createContext({\r\n  ...initialState,\r\n  method: 'jwt',\r\n  login: () => Promise.resolve(),\r\n  logout: () => Promise.resolve(),\r\n  register: () => Promise.resolve()\r\n});\r\n\r\nAuthProvider.propTypes = {\r\n  children: PropTypes.node\r\n};\r\n\r\nfunction AuthProvider({ children }) {\r\n  const [state, dispatch] = useReducer(reducer, initialState);\r\n\r\n  useEffect(() => {\r\n    const initialize = async () => {\r\n      try {\r\n        const accessToken = window.localStorage.getItem('accessToken');\r\n\r\n        if (accessToken && isValidToken(accessToken)) {\r\n          setSession(accessToken);\r\n\r\n          const response = await axios.get('/auth/me', {\r\n            headers: {\r\n              Authorization: `Bearer ${accessToken}`\r\n            }\r\n          });\r\n          const { user } = response.data;\r\n\r\n          dispatch({\r\n            type: 'INITIALIZE',\r\n            payload: {\r\n              isAuthenticated: true,\r\n              user\r\n            }\r\n          });\r\n        } else {\r\n          dispatch({\r\n            type: 'INITIALIZE',\r\n            payload: {\r\n              isAuthenticated: false,\r\n              user: null\r\n            }\r\n          });\r\n        }\r\n      } catch (err) {\r\n        console.error(err);\r\n        dispatch({\r\n          type: 'INITIALIZE',\r\n          payload: {\r\n            isAuthenticated: false,\r\n            user: null\r\n          }\r\n        });\r\n      }\r\n    };\r\n\r\n    initialize();\r\n  }, []);\r\n\r\n  const login = async (email, password) => {\r\n    const response = await axios.post('/auth/adminlogin', {\r\n      email,\r\n      password\r\n    });\r\n\r\n    if (response.data.success) {\r\n      const { accessToken, user } = response.data;\r\n\r\n      setSession(accessToken);\r\n      dispatch({\r\n        type: 'LOGIN',\r\n        payload: {\r\n          user\r\n        }\r\n      });\r\n    } else {\r\n      dispatch({\r\n        type: 'INITIALIZE',\r\n        payload: {\r\n          isAuthenticated: false,\r\n          user: null\r\n        }\r\n      });\r\n    }\r\n\r\n    return response;\r\n  };\r\n\r\n  const register = async (email, password, firstName, lastName) => {\r\n    const response = await axios.post('/api/account/register', {\r\n      email,\r\n      password,\r\n      firstName,\r\n      lastName\r\n    });\r\n    const { accessToken, user } = response.data;\r\n\r\n    window.localStorage.setItem('accessToken', accessToken);\r\n    dispatch({\r\n      type: 'REGISTER',\r\n      payload: {\r\n        user\r\n      }\r\n    });\r\n  };\r\n\r\n  const logout = async () => {\r\n    // const accessToken = window.localStorage.getItem('accessToken');\r\n    // if (accessToken && isValidToken(accessToken)) {\r\n    //   await axios.post(`/auth/logout`, {\r\n    //     headers: {\r\n    //       Authorization: `Bearer ${accessToken}`\r\n    //     }\r\n    //   });\r\n    // }\r\n    await axios.post(`/auth/logout`);\r\n    setSession(null);\r\n    dispatch({ type: 'LOGOUT' });\r\n  };\r\n\r\n  const resetPassword = () => {};\r\n\r\n  const updateProfile = () => {};\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        ...state,\r\n        method: 'jwt',\r\n        login,\r\n        logout,\r\n        register,\r\n        resetPassword,\r\n        updateProfile\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport { AuthContext, AuthProvider };\r\n"]},"metadata":{},"sourceType":"module"}