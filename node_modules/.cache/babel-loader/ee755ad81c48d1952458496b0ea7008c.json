{"ast":null,"code":"var _jsxFileName = \"E:\\\\projects\\\\localtalk.mobi(react+node)\\\\pro\\\\toptalk-adminpanel\\\\src\\\\components\\\\_dashboard\\\\privatechat\\\\ChatMessageInput.js\";\nimport { v4 as uuidv4 } from 'uuid';\nimport PropTypes from 'prop-types';\nimport { Icon } from '@iconify/react';\nimport { useRef, useState } from 'react';\nimport micFill from '@iconify/icons-eva/mic-fill';\nimport roundSend from '@iconify/icons-ic/round-send';\nimport attach2Fill from '@iconify/icons-eva/attach-2-fill';\nimport roundAddPhotoAlternate from '@iconify/icons-ic/round-add-photo-alternate'; // material\n\nimport { styled } from '@material-ui/core/styles';\nimport { Input, Divider, IconButton, InputAdornment, Stack, Box } from '@material-ui/core'; // redux\n\nimport { useDispatch, useSelector } from '../../../redux/store';\nimport { addRecipients, onSendMessage, getConversation, getParticipants, markConversationAsRead, resetActiveConversation } from '../../../redux/slices/privatechat';\nimport axios from '../../../utils/axios'; // hooks\n\nimport useAuth from '../../../hooks/useAuth'; //\n\nimport EmojiPicker from '../../EmojiPicker'; // ----------------------------------------------------------------------\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst RootStyle = styled('div')(({\n  theme\n}) => ({\n  // minHeight: 56,\n  height: 'auto',\n  // display: 'flex',\n  position: 'relative',\n  alignItems: 'center',\n  paddingLeft: theme.spacing(2)\n}));\nconst MessageImgStyle = styled('img')(({\n  theme\n}) => ({\n  height: 40,\n  minWidth: 40,\n  width: 'auto',\n  cursor: 'pointer',\n  objectFit: 'cover',\n  borderRadius: theme.shape.borderRadius\n})); // ----------------------------------------------------------------------\n\nChatMessageInput.propTypes = {\n  disabled: PropTypes.bool,\n  conversationId: PropTypes.string,\n  opponentId: PropTypes.string,\n  onSend: PropTypes.func,\n  messageMaxLen: PropTypes.number\n};\nexport default function ChatMessageInput({\n  disabled,\n  conversationId,\n  opponentId,\n  onSend,\n  messageMaxLen,\n  ...other\n}) {\n  const dispatch = useDispatch();\n  const fileInputRef = useRef(null);\n  const [message, setMessage] = useState('');\n  const {\n    user\n  } = useAuth();\n  const [imageFiles, setImageFiles] = useState([]);\n  const [uploadImgs, setUploadImgs] = useState(null);\n\n  const handleAttach = () => {\n    fileInputRef.current.click();\n  };\n\n  const handleImageUpload = e => {\n    // console.log(e.target.files);\n    const fileObj = [];\n    const fileArray = [];\n    const formData = new FormData();\n    fileObj.push(e.target.files);\n\n    for (let i = 0; i < fileObj[0].length; i += 1) {\n      const file = fileObj[0][i];\n      formData.append(`img[${i}]`, file, file.name);\n      fileArray.push({\n        index: i,\n        name: file.name,\n        url: URL.createObjectURL(file)\n      });\n    } // console.log(fileArray);\n\n\n    setImageFiles(fileArray);\n    setUploadImgs(formData);\n  };\n\n  const handleChangeMessage = event => {\n    setMessage(event.target.value);\n  };\n\n  const handleKeyUp = event => {\n    if (event.key === 'Enter') {\n      handleSend();\n    }\n  };\n\n  const handleSend = async () => {\n    if (!message && imageFiles.length === 0) {\n      return '';\n    }\n\n    if (onSend) {\n      // const accessToken = window.localStorage.getItem('accessToken');\n      // const authHeader = {\n      //   headers: {\n      //     Authorization: `Bearer ${accessToken}`\n      //   }\n      // };\n      let imgs = [];\n\n      if (uploadImgs) {\n        const res = await axios.post('/message/upload_multi_imgs', uploadImgs);\n        imgs = res.data.data;\n        setImageFiles([]);\n        setUploadImgs(null);\n      }\n\n      onSend({\n        conversationId,\n        messageId: uuidv4(),\n        message,\n        imgs,\n        senderId: user._id,\n        senderName: user.name,\n        messageType: 0,\n        receiverId: opponentId\n      });\n    }\n\n    return setMessage('');\n  };\n\n  return /*#__PURE__*/_jsxDEV(RootStyle, { ...other,\n    children: [imageFiles.length > 0 && /*#__PURE__*/_jsxDEV(Stack, {\n      direction: {\n        xs: 'column',\n        sm: 'row'\n      },\n      sx: {\n        mt: 1,\n        mb: 1\n      },\n      spacing: {\n        xs: 3,\n        sm: 2\n      },\n      children: imageFiles.map(img => /*#__PURE__*/_jsxDEV(MessageImgStyle, {\n        alt: \"attachment\",\n        src: `${img.url}`\n      }, `${img.index}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Stack, {\n      direction: {\n        xs: 'column',\n        sm: 'row'\n      },\n      sx: {\n        mt: 1,\n        mb: 1\n      },\n      children: [/*#__PURE__*/_jsxDEV(Input, {\n        disabled: disabled,\n        fullWidth: true,\n        value: message,\n        disableUnderline: true,\n        onKeyUp: handleKeyUp,\n        onChange: handleChangeMessage,\n        placeholder: \"Type a message\",\n        inputProps: {\n          maxLength: messageMaxLen || 1000\n        },\n        startAdornment: /*#__PURE__*/_jsxDEV(InputAdornment, {\n          position: \"start\",\n          children: /*#__PURE__*/_jsxDEV(EmojiPicker, {\n            disabled: disabled,\n            value: message,\n            setValue: setMessage\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 13\n        }, this),\n        endAdornment: /*#__PURE__*/_jsxDEV(Stack, {\n          direction: \"row\",\n          spacing: 0.5,\n          mr: 1.5,\n          children: /*#__PURE__*/_jsxDEV(IconButton, {\n            disabled: disabled,\n            size: \"small\",\n            onClick: handleAttach,\n            children: /*#__PURE__*/_jsxDEV(Icon, {\n              icon: roundAddPhotoAlternate,\n              width: 24,\n              height: 24\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 158,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 13\n        }, this),\n        sx: {\n          height: '100%'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Divider, {\n        orientation: \"vertical\",\n        flexItem: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(IconButton, {\n        color: \"primary\",\n        disabled: !message && imageFiles.length === 0,\n        onClick: handleSend,\n        sx: {\n          mx: 1\n        },\n        children: /*#__PURE__*/_jsxDEV(Icon, {\n          icon: roundSend,\n          width: 24,\n          height: 24\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"file\",\n      multiple: true,\n      ref: fileInputRef,\n      accept: \"image/*\",\n      style: {\n        display: 'none'\n      },\n      onChange: handleImageUpload\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 132,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"sources":["E:/projects/localtalk.mobi(react+node)/pro/toptalk-adminpanel/src/components/_dashboard/privatechat/ChatMessageInput.js"],"names":["v4","uuidv4","PropTypes","Icon","useRef","useState","micFill","roundSend","attach2Fill","roundAddPhotoAlternate","styled","Input","Divider","IconButton","InputAdornment","Stack","Box","useDispatch","useSelector","addRecipients","onSendMessage","getConversation","getParticipants","markConversationAsRead","resetActiveConversation","axios","useAuth","EmojiPicker","RootStyle","theme","height","position","alignItems","paddingLeft","spacing","MessageImgStyle","minWidth","width","cursor","objectFit","borderRadius","shape","ChatMessageInput","propTypes","disabled","bool","conversationId","string","opponentId","onSend","func","messageMaxLen","number","other","dispatch","fileInputRef","message","setMessage","user","imageFiles","setImageFiles","uploadImgs","setUploadImgs","handleAttach","current","click","handleImageUpload","e","fileObj","fileArray","formData","FormData","push","target","files","i","length","file","append","name","index","url","URL","createObjectURL","handleChangeMessage","event","value","handleKeyUp","key","handleSend","imgs","res","post","data","messageId","senderId","_id","senderName","messageType","receiverId","xs","sm","mt","mb","map","img","maxLength","mx","display"],"mappings":";AAAA,SAASA,EAAE,IAAIC,MAAf,QAA6B,MAA7B;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,IAAT,QAAqB,gBAArB;AACA,SAASC,MAAT,EAAiBC,QAAjB,QAAiC,OAAjC;AACA,OAAOC,OAAP,MAAoB,6BAApB;AACA,OAAOC,SAAP,MAAsB,8BAAtB;AACA,OAAOC,WAAP,MAAwB,kCAAxB;AACA,OAAOC,sBAAP,MAAmC,6CAAnC,C,CACA;;AACA,SAASC,MAAT,QAAuB,0BAAvB;AACA,SAASC,KAAT,EAAgBC,OAAhB,EAAyBC,UAAzB,EAAqCC,cAArC,EAAqDC,KAArD,EAA4DC,GAA5D,QAAuE,mBAAvE,C,CACA;;AACA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,sBAAzC;AACA,SACEC,aADF,EAEEC,aAFF,EAGEC,eAHF,EAIEC,eAJF,EAKEC,sBALF,EAMEC,uBANF,QAOO,mCAPP;AAQA,OAAOC,KAAP,MAAkB,sBAAlB,C,CACA;;AACA,OAAOC,OAAP,MAAoB,wBAApB,C,CACA;;AACA,OAAOC,WAAP,MAAwB,mBAAxB,C,CAEA;;;AAEA,MAAMC,SAAS,GAAGlB,MAAM,CAAC,KAAD,CAAN,CAAc,CAAC;AAAEmB,EAAAA;AAAF,CAAD,MAAgB;AAC9C;AACAC,EAAAA,MAAM,EAAE,MAFsC;AAG9C;AACAC,EAAAA,QAAQ,EAAE,UAJoC;AAK9CC,EAAAA,UAAU,EAAE,QALkC;AAM9CC,EAAAA,WAAW,EAAEJ,KAAK,CAACK,OAAN,CAAc,CAAd;AANiC,CAAhB,CAAd,CAAlB;AASA,MAAMC,eAAe,GAAGzB,MAAM,CAAC,KAAD,CAAN,CAAc,CAAC;AAAEmB,EAAAA;AAAF,CAAD,MAAgB;AACpDC,EAAAA,MAAM,EAAE,EAD4C;AAEpDM,EAAAA,QAAQ,EAAE,EAF0C;AAGpDC,EAAAA,KAAK,EAAE,MAH6C;AAIpDC,EAAAA,MAAM,EAAE,SAJ4C;AAKpDC,EAAAA,SAAS,EAAE,OALyC;AAMpDC,EAAAA,YAAY,EAAEX,KAAK,CAACY,KAAN,CAAYD;AAN0B,CAAhB,CAAd,CAAxB,C,CASA;;AAEAE,gBAAgB,CAACC,SAAjB,GAA6B;AAC3BC,EAAAA,QAAQ,EAAE1C,SAAS,CAAC2C,IADO;AAE3BC,EAAAA,cAAc,EAAE5C,SAAS,CAAC6C,MAFC;AAG3BC,EAAAA,UAAU,EAAE9C,SAAS,CAAC6C,MAHK;AAI3BE,EAAAA,MAAM,EAAE/C,SAAS,CAACgD,IAJS;AAK3BC,EAAAA,aAAa,EAAEjD,SAAS,CAACkD;AALE,CAA7B;AAQA,eAAe,SAASV,gBAAT,CAA0B;AAAEE,EAAAA,QAAF;AAAYE,EAAAA,cAAZ;AAA4BE,EAAAA,UAA5B;AAAwCC,EAAAA,MAAxC;AAAgDE,EAAAA,aAAhD;AAA+D,KAAGE;AAAlE,CAA1B,EAAqG;AAClH,QAAMC,QAAQ,GAAGrC,WAAW,EAA5B;AACA,QAAMsC,YAAY,GAAGnD,MAAM,CAAC,IAAD,CAA3B;AACA,QAAM,CAACoD,OAAD,EAAUC,UAAV,IAAwBpD,QAAQ,CAAC,EAAD,CAAtC;AACA,QAAM;AAAEqD,IAAAA;AAAF,MAAWhC,OAAO,EAAxB;AACA,QAAM,CAACiC,UAAD,EAAaC,aAAb,IAA8BvD,QAAQ,CAAC,EAAD,CAA5C;AACA,QAAM,CAACwD,UAAD,EAAaC,aAAb,IAA8BzD,QAAQ,CAAC,IAAD,CAA5C;;AAEA,QAAM0D,YAAY,GAAG,MAAM;AACzBR,IAAAA,YAAY,CAACS,OAAb,CAAqBC,KAArB;AACD,GAFD;;AAIA,QAAMC,iBAAiB,GAAIC,CAAD,IAAO;AAC/B;AACA,UAAMC,OAAO,GAAG,EAAhB;AACA,UAAMC,SAAS,GAAG,EAAlB;AACA,UAAMC,QAAQ,GAAG,IAAIC,QAAJ,EAAjB;AACAH,IAAAA,OAAO,CAACI,IAAR,CAAaL,CAAC,CAACM,MAAF,CAASC,KAAtB;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGP,OAAO,CAAC,CAAD,CAAP,CAAWQ,MAA/B,EAAuCD,CAAC,IAAI,CAA5C,EAA+C;AAC7C,YAAME,IAAI,GAAGT,OAAO,CAAC,CAAD,CAAP,CAAWO,CAAX,CAAb;AACAL,MAAAA,QAAQ,CAACQ,MAAT,CAAiB,OAAMH,CAAE,GAAzB,EAA6BE,IAA7B,EAAmCA,IAAI,CAACE,IAAxC;AACAV,MAAAA,SAAS,CAACG,IAAV,CAAe;AAAEQ,QAAAA,KAAK,EAAEL,CAAT;AAAYI,QAAAA,IAAI,EAAEF,IAAI,CAACE,IAAvB;AAA6BE,QAAAA,GAAG,EAAEC,GAAG,CAACC,eAAJ,CAAoBN,IAApB;AAAlC,OAAf;AACD,KAV8B,CAW/B;;;AACAjB,IAAAA,aAAa,CAACS,SAAD,CAAb;AACAP,IAAAA,aAAa,CAACQ,QAAD,CAAb;AACD,GAdD;;AAgBA,QAAMc,mBAAmB,GAAIC,KAAD,IAAW;AACrC5B,IAAAA,UAAU,CAAC4B,KAAK,CAACZ,MAAN,CAAaa,KAAd,CAAV;AACD,GAFD;;AAIA,QAAMC,WAAW,GAAIF,KAAD,IAAW;AAC7B,QAAIA,KAAK,CAACG,GAAN,KAAc,OAAlB,EAA2B;AACzBC,MAAAA,UAAU;AACX;AACF,GAJD;;AAMA,QAAMA,UAAU,GAAG,YAAY;AAC7B,QAAI,CAACjC,OAAD,IAAYG,UAAU,CAACiB,MAAX,KAAsB,CAAtC,EAAyC;AACvC,aAAO,EAAP;AACD;;AACD,QAAI3B,MAAJ,EAAY;AACV;AACA;AACA;AACA;AACA;AACA;AAEA,UAAIyC,IAAI,GAAG,EAAX;;AAEA,UAAI7B,UAAJ,EAAgB;AACd,cAAM8B,GAAG,GAAG,MAAMlE,KAAK,CAACmE,IAAN,CAAW,4BAAX,EAAyC/B,UAAzC,CAAlB;AACA6B,QAAAA,IAAI,GAAGC,GAAG,CAACE,IAAJ,CAASA,IAAhB;AACAjC,QAAAA,aAAa,CAAC,EAAD,CAAb;AACAE,QAAAA,aAAa,CAAC,IAAD,CAAb;AACD;;AAEDb,MAAAA,MAAM,CAAC;AACLH,QAAAA,cADK;AAELgD,QAAAA,SAAS,EAAE7F,MAAM,EAFZ;AAGLuD,QAAAA,OAHK;AAILkC,QAAAA,IAJK;AAKLK,QAAAA,QAAQ,EAAErC,IAAI,CAACsC,GALV;AAMLC,QAAAA,UAAU,EAAEvC,IAAI,CAACqB,IANZ;AAOLmB,QAAAA,WAAW,EAAE,CAPR;AAQLC,QAAAA,UAAU,EAAEnD;AARP,OAAD,CAAN;AAUD;;AACD,WAAOS,UAAU,CAAC,EAAD,CAAjB;AACD,GAjCD;;AAmCA,sBACE,QAAC,SAAD,OAAeJ,KAAf;AAAA,eACGM,UAAU,CAACiB,MAAX,GAAoB,CAApB,iBACC,QAAC,KAAD;AAAO,MAAA,SAAS,EAAE;AAAEwB,QAAAA,EAAE,EAAE,QAAN;AAAgBC,QAAAA,EAAE,EAAE;AAApB,OAAlB;AAA+C,MAAA,EAAE,EAAE;AAAEC,QAAAA,EAAE,EAAE,CAAN;AAASC,QAAAA,EAAE,EAAE;AAAb,OAAnD;AAAqE,MAAA,OAAO,EAAE;AAAEH,QAAAA,EAAE,EAAE,CAAN;AAASC,QAAAA,EAAE,EAAE;AAAb,OAA9E;AAAA,gBACG1C,UAAU,CAAC6C,GAAX,CAAgBC,GAAD,iBACd,QAAC,eAAD;AAAsC,QAAA,GAAG,EAAC,YAA1C;AAAuD,QAAA,GAAG,EAAG,GAAEA,GAAG,CAACxB,GAAI;AAAvE,SAAuB,GAAEwB,GAAG,CAACzB,KAAM,EAAnC;AAAA;AAAA;AAAA;AAAA,cADD;AADH;AAAA;AAAA;AAAA;AAAA,YAFJ,eAQE,QAAC,KAAD;AAAO,MAAA,SAAS,EAAE;AAAEoB,QAAAA,EAAE,EAAE,QAAN;AAAgBC,QAAAA,EAAE,EAAE;AAApB,OAAlB;AAA+C,MAAA,EAAE,EAAE;AAAEC,QAAAA,EAAE,EAAE,CAAN;AAASC,QAAAA,EAAE,EAAE;AAAb,OAAnD;AAAA,8BACE,QAAC,KAAD;AACE,QAAA,QAAQ,EAAE3D,QADZ;AAEE,QAAA,SAAS,MAFX;AAGE,QAAA,KAAK,EAAEY,OAHT;AAIE,QAAA,gBAAgB,MAJlB;AAKE,QAAA,OAAO,EAAE+B,WALX;AAME,QAAA,QAAQ,EAAEH,mBANZ;AAOE,QAAA,WAAW,EAAC,gBAPd;AAQE,QAAA,UAAU,EAAE;AAAEsB,UAAAA,SAAS,EAAEvD,aAAa,IAAI;AAA9B,SARd;AASE,QAAA,cAAc,eACZ,QAAC,cAAD;AAAgB,UAAA,QAAQ,EAAC,OAAzB;AAAA,iCACE,QAAC,WAAD;AAAa,YAAA,QAAQ,EAAEP,QAAvB;AAAiC,YAAA,KAAK,EAAEY,OAAxC;AAAiD,YAAA,QAAQ,EAAEC;AAA3D;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBAVJ;AAcE,QAAA,YAAY,eACV,QAAC,KAAD;AAAO,UAAA,SAAS,EAAC,KAAjB;AAAuB,UAAA,OAAO,EAAE,GAAhC;AAAqC,UAAA,EAAE,EAAE,GAAzC;AAAA,iCACE,QAAC,UAAD;AAAY,YAAA,QAAQ,EAAEb,QAAtB;AAAgC,YAAA,IAAI,EAAC,OAArC;AAA6C,YAAA,OAAO,EAAEmB,YAAtD;AAAA,mCACE,QAAC,IAAD;AAAM,cAAA,IAAI,EAAEtD,sBAAZ;AAAoC,cAAA,KAAK,EAAE,EAA3C;AAA+C,cAAA,MAAM,EAAE;AAAvD;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBAfJ;AA2BE,QAAA,EAAE,EAAE;AAAEqB,UAAAA,MAAM,EAAE;AAAV;AA3BN;AAAA;AAAA;AAAA;AAAA,cADF,eA+BE,QAAC,OAAD;AAAS,QAAA,WAAW,EAAC,UAArB;AAAgC,QAAA,QAAQ;AAAxC;AAAA;AAAA;AAAA;AAAA,cA/BF,eAiCE,QAAC,UAAD;AAAY,QAAA,KAAK,EAAC,SAAlB;AAA4B,QAAA,QAAQ,EAAE,CAAC0B,OAAD,IAAYG,UAAU,CAACiB,MAAX,KAAsB,CAAxE;AAA2E,QAAA,OAAO,EAAEa,UAApF;AAAgG,QAAA,EAAE,EAAE;AAAEkB,UAAAA,EAAE,EAAE;AAAN,SAApG;AAAA,+BACE,QAAC,IAAD;AAAM,UAAA,IAAI,EAAEpG,SAAZ;AAAuB,UAAA,KAAK,EAAE,EAA9B;AAAkC,UAAA,MAAM,EAAE;AAA1C;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,cAjCF;AAAA;AAAA;AAAA;AAAA;AAAA,YARF,eA8CE;AACE,MAAA,IAAI,EAAC,MADP;AAEE,MAAA,QAAQ,MAFV;AAGE,MAAA,GAAG,EAAEgD,YAHP;AAIE,MAAA,MAAM,EAAC,SAJT;AAKE,MAAA,KAAK,EAAE;AAAEqD,QAAAA,OAAO,EAAE;AAAX,OALT;AAME,MAAA,QAAQ,EAAE1C;AANZ;AAAA;AAAA;AAAA;AAAA,YA9CF;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AAyDD","sourcesContent":["import { v4 as uuidv4 } from 'uuid';\r\nimport PropTypes from 'prop-types';\r\nimport { Icon } from '@iconify/react';\r\nimport { useRef, useState } from 'react';\r\nimport micFill from '@iconify/icons-eva/mic-fill';\r\nimport roundSend from '@iconify/icons-ic/round-send';\r\nimport attach2Fill from '@iconify/icons-eva/attach-2-fill';\r\nimport roundAddPhotoAlternate from '@iconify/icons-ic/round-add-photo-alternate';\r\n// material\r\nimport { styled } from '@material-ui/core/styles';\r\nimport { Input, Divider, IconButton, InputAdornment, Stack, Box } from '@material-ui/core';\r\n// redux\r\nimport { useDispatch, useSelector } from '../../../redux/store';\r\nimport {\r\n  addRecipients,\r\n  onSendMessage,\r\n  getConversation,\r\n  getParticipants,\r\n  markConversationAsRead,\r\n  resetActiveConversation\r\n} from '../../../redux/slices/privatechat';\r\nimport axios from '../../../utils/axios';\r\n// hooks\r\nimport useAuth from '../../../hooks/useAuth';\r\n//\r\nimport EmojiPicker from '../../EmojiPicker';\r\n\r\n// ----------------------------------------------------------------------\r\n\r\nconst RootStyle = styled('div')(({ theme }) => ({\r\n  // minHeight: 56,\r\n  height: 'auto',\r\n  // display: 'flex',\r\n  position: 'relative',\r\n  alignItems: 'center',\r\n  paddingLeft: theme.spacing(2)\r\n}));\r\n\r\nconst MessageImgStyle = styled('img')(({ theme }) => ({\r\n  height: 40,\r\n  minWidth: 40,\r\n  width: 'auto',\r\n  cursor: 'pointer',\r\n  objectFit: 'cover',\r\n  borderRadius: theme.shape.borderRadius\r\n}));\r\n\r\n// ----------------------------------------------------------------------\r\n\r\nChatMessageInput.propTypes = {\r\n  disabled: PropTypes.bool,\r\n  conversationId: PropTypes.string,\r\n  opponentId: PropTypes.string,\r\n  onSend: PropTypes.func,\r\n  messageMaxLen: PropTypes.number\r\n};\r\n\r\nexport default function ChatMessageInput({ disabled, conversationId, opponentId, onSend, messageMaxLen, ...other }) {\r\n  const dispatch = useDispatch();\r\n  const fileInputRef = useRef(null);\r\n  const [message, setMessage] = useState('');\r\n  const { user } = useAuth();\r\n  const [imageFiles, setImageFiles] = useState([]);\r\n  const [uploadImgs, setUploadImgs] = useState(null);\r\n\r\n  const handleAttach = () => {\r\n    fileInputRef.current.click();\r\n  };\r\n\r\n  const handleImageUpload = (e) => {\r\n    // console.log(e.target.files);\r\n    const fileObj = [];\r\n    const fileArray = [];\r\n    const formData = new FormData();\r\n    fileObj.push(e.target.files);\r\n    for (let i = 0; i < fileObj[0].length; i += 1) {\r\n      const file = fileObj[0][i];\r\n      formData.append(`img[${i}]`, file, file.name);\r\n      fileArray.push({ index: i, name: file.name, url: URL.createObjectURL(file) });\r\n    }\r\n    // console.log(fileArray);\r\n    setImageFiles(fileArray);\r\n    setUploadImgs(formData);\r\n  };\r\n\r\n  const handleChangeMessage = (event) => {\r\n    setMessage(event.target.value);\r\n  };\r\n\r\n  const handleKeyUp = (event) => {\r\n    if (event.key === 'Enter') {\r\n      handleSend();\r\n    }\r\n  };\r\n\r\n  const handleSend = async () => {\r\n    if (!message && imageFiles.length === 0) {\r\n      return '';\r\n    }\r\n    if (onSend) {\r\n      // const accessToken = window.localStorage.getItem('accessToken');\r\n      // const authHeader = {\r\n      //   headers: {\r\n      //     Authorization: `Bearer ${accessToken}`\r\n      //   }\r\n      // };\r\n\r\n      let imgs = [];\r\n\r\n      if (uploadImgs) {\r\n        const res = await axios.post('/message/upload_multi_imgs', uploadImgs);\r\n        imgs = res.data.data;\r\n        setImageFiles([]);\r\n        setUploadImgs(null);\r\n      }\r\n\r\n      onSend({\r\n        conversationId,\r\n        messageId: uuidv4(),\r\n        message,\r\n        imgs,\r\n        senderId: user._id,\r\n        senderName: user.name,\r\n        messageType: 0,\r\n        receiverId: opponentId\r\n      });\r\n    }\r\n    return setMessage('');\r\n  };\r\n\r\n  return (\r\n    <RootStyle {...other}>\r\n      {imageFiles.length > 0 && (\r\n        <Stack direction={{ xs: 'column', sm: 'row' }} sx={{ mt: 1, mb: 1 }} spacing={{ xs: 3, sm: 2 }}>\r\n          {imageFiles.map((img) => (\r\n            <MessageImgStyle key={`${img.index}`} alt=\"attachment\" src={`${img.url}`} />\r\n          ))}\r\n        </Stack>\r\n      )}\r\n      <Stack direction={{ xs: 'column', sm: 'row' }} sx={{ mt: 1, mb: 1 }}>\r\n        <Input\r\n          disabled={disabled}\r\n          fullWidth\r\n          value={message}\r\n          disableUnderline\r\n          onKeyUp={handleKeyUp}\r\n          onChange={handleChangeMessage}\r\n          placeholder=\"Type a message\"\r\n          inputProps={{ maxLength: messageMaxLen || 1000 }}\r\n          startAdornment={\r\n            <InputAdornment position=\"start\">\r\n              <EmojiPicker disabled={disabled} value={message} setValue={setMessage} />\r\n            </InputAdornment>\r\n          }\r\n          endAdornment={\r\n            <Stack direction=\"row\" spacing={0.5} mr={1.5}>\r\n              <IconButton disabled={disabled} size=\"small\" onClick={handleAttach}>\r\n                <Icon icon={roundAddPhotoAlternate} width={24} height={24} />\r\n              </IconButton>\r\n              {/* <IconButton disabled={disabled} size=\"small\" onClick={handleAttach}>\r\n                <Icon icon={attach2Fill} width={24} height={24} />\r\n              </IconButton>\r\n              <IconButton disabled={disabled} size=\"small\">\r\n                <Icon icon={micFill} width={24} height={24} />\r\n              </IconButton> */}\r\n            </Stack>\r\n          }\r\n          sx={{ height: '100%' }}\r\n        />\r\n\r\n        <Divider orientation=\"vertical\" flexItem />\r\n\r\n        <IconButton color=\"primary\" disabled={!message && imageFiles.length === 0} onClick={handleSend} sx={{ mx: 1 }}>\r\n          <Icon icon={roundSend} width={24} height={24} />\r\n        </IconButton>\r\n      </Stack>\r\n\r\n      <input\r\n        type=\"file\"\r\n        multiple\r\n        ref={fileInputRef}\r\n        accept=\"image/*\"\r\n        style={{ display: 'none' }}\r\n        onChange={handleImageUpload}\r\n      />\r\n    </RootStyle>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}